!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";function t(t,e){Object.keys(e).forEach(s=>{e[s]||""===e[s]?t.setAttribute(s,e[s]):t.removeAttribute(s)})}function e(t,e){Object.keys(e).forEach(s=>{t[s]=e[s]})}function s(t,e){t&&e&&Object.keys(e).forEach(s=>{Array.isArray(e[s])?e[s].forEach(e=>{t.addEventListener(s,e)}):t.addEventListener(s,e[s])})}function i(t,e){t&&e&&Object.keys(e).forEach(s=>{Array.isArray(e[s])?e[s].forEach(e=>{t.removeEventListener(s,e)}):t.removeEventListener(s,e[s])})}function n(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function r(t,e,s,...i){if(t){if(s)return t.children&&t.children.forEach(t=>{r(t,e,s,...i)}),void(t.instance&&t.instance[e](...i));t.instance&&t.instance[e](...i),t.children&&t.children.forEach(t=>{r(t,e,s,...i)})}}class o{constructor(t,e=!1){this._value=t,this.forces=e,this.setterTimeout=null,this.subscribers=[],this.isDestroy=!1,this.firstState=t}get value(){return this._value}destroy(t=!1){this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.isDestroy=!0,t&&(this.subscribers=[])}reInit(){this.isDestroy=!1,this.value=this.firstState}addSubscribers(t){this.isDestroy||this.subscribers.push(t)}set value(t){this.isDestroy||(this._value!==t||this.forces)&&(this._value=t,this.subscribers.length&&(this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.setterTimeout=requestAnimationFrame(()=>{this.subscribers.forEach(e=>{e(t)})})))}}class a{constructor(t={}){this.obsArr=[],this.values={},this.obs=new o(this.values,!0),this.isDestroyed=!1,Object.keys(t).forEach(e=>{const s=t[e];"object"==typeof s?(this.obsArr.push(s),this.values[e]=s.value,s.addSubscribers(t=>{this.values[e]=t,this.obs.value=this.values})):this.values[e]=s})}get value(){return this.obs}reInit(){this.isDestroyed=!1,this.obs.reInit(),this.obsArr.forEach(t=>{t.reInit()})}destroy(t=!1){this.isDestroyed||(this.obs.destroy(t),this.obsArr.forEach(e=>{e.destroy(t)}),this.isDestroyed=!0)}}const c=Symbol("instance");function l(n){if(!1===n.show)return null;const o="textNode"!==n.tag?document.createElement(n.tag):document.createTextNode("");if(n.domNode=o,null!==n.textValue||void 0!==n.textValue)if("object"==typeof n.textValue){const t=n.textValue;t.addSubscribers(t=>{o.textContent=t}),o.textContent=t.value}else o.textContent=n.textValue;let u,h,d;if("textNode"!==n.tag){if(n.classList)if(Array.isArray(n.classList))n.classList.forEach(t=>{o.classList.add(t)});else{u=n.classList;const t=n.classList.value;Object.keys(t.value).forEach(e=>{return t.value[e]?o.classList.add(e):o.classList.remove(e)}),t.addSubscribers(t=>{Object.keys(t).forEach(e=>{return t[e]?o.classList.add(e):o.classList.remove(e)})})}if(n.props)if(n.props instanceof a){d=n.props;const t=n.props.value;e(o,t.value),t.addSubscribers(t=>{e(o,t)})}else e(o,n.props);if(n.attrs)if(n.attrs instanceof a){h=n.attrs;const e=n.attrs.value;t(o,e.value),e.addSubscribers(e=>{t(o,e)})}else t(o,n.attrs);n.children&&n.children.forEach(t=>{if(!t)return;if(Array.isArray(t))return t.forEach(t=>{if(!t.tag)return void o.appendChild(t);const e=l(Object.assign(t,{parent:o}));e&&o.appendChild(e)}),void(t._parent=o);if(!t.tag)return void o.appendChild(t);const e=l(Object.assign(t,{parent:o}));e&&o.appendChild(e)}),n.listeners&&s(o,n.listeners)}if(n.instance&&(o[c]=n.instance,n.instance.onInit()),"object"==typeof n.show){const t=document.createComment("");return n.show.addSubscribers(e=>{const a=n.parent?n.parent:null;e?a&&(t.parentNode===a&&a.replaceChild(o,t),r(n,"reInit",!1),u&&u.reInit(),d&&d.reInit(),h&&h.reInit(),"textNode"!==n.tag&&s(o,n.listeners)):a&&("textNode"!==n.tag&&i(o,n.listeners),h&&h.destroy(),d&&d.reInit(),u&&u.destroy(),r(n,"destroy",!0),o.parentNode===a&&a.replaceChild(t,o))}),n.show.value?o:t}return o}function u(t,e={}){const s=new t(e);return s.template.instance=s,s.template}class h{constructor(){this.reactive={},this.fdObjects={}}onDestroy(){}onInit(){}reInit(){Object.keys(this.fdObjects).forEach(t=>{this.fdObjects[t].reInit()}),Object.keys(this.reactive).forEach(t=>{this.reactive[t].reInit()}),this.onInit()}destroy(...t){!0===t[0]&&function t(e){e.listeners&&i(e.domNode,e.listeners),e.children&&e.children.forEach(e=>{!e.instance&&e.tag&&t(e)})}(this.template),Object.keys(this.fdObjects).forEach(e=>{this.fdObjects[e].destroy(...t)}),Object.keys(this.reactive).forEach(e=>{this.reactive[e].destroy(...t)}),this.onDestroy()}}const d=new class extends h{constructor(t){super(),this.baseHref=t,this._paths={},this._cUrl="",this._currentComp=null,this.template={tag:"div",classList:["router-view"]},this.onPopState=(t=>{this.applyUrl(t.isTrusted?t.state:this.baseHref+t.state)}),this.applyUrl=(t=>{const e=Object.keys(this._paths).find(e=>e===t.replace(/[\\\\\/]+/g,"/"));if(!e)return;const s=this._paths[e];this._currentComp&&r(this._currentComp,"destroy",!0,!0),n(this.template.domNode),s.title&&(document.title=s.title),this._cUrl=s.path;const i=s.component();this.template.domNode.appendChild(l(i)),this._currentComp=i;const o=(this.baseHref+s.path).replace(/[\\\\\/]+/g,"/");window.history.pushState(o,document.title,o)})}setPaths(t={}){const e={};Object.keys(t).forEach(s=>{e[(this.baseHref+s).replace(/[\\\\\/]+/g,"/")]={component:t[s].component,title:t[s].title,path:s}}),this._paths=e}onInit(){window.addEventListener("popstate",this.onPopState),this.goToUrl("/")}onDestroy(){window.removeEventListener("popstate",this.onPopState)}goToUrl(t){this._cUrl!==t&&dispatchEvent(new PopStateEvent("popstate",{state:t}))}}(window.location.pathname);function p(t){return m(t)}function m(t){return new o(t)}const v=(t,e,s={},i)=>{if("function"==typeof e){const n={};return Object.keys(s).forEach(e=>{const i=s[e];n[e]="function"==typeof i?i(t):i}),e(Object.assign({},n,{index:i}))}return Object.assign({},e,{textValue:e.textValue(t),index:i})};function f(t,e,s={}){if(Array.isArray(t))return t.map((t,i)=>v(t,e,s,i));let i=t.value.map((t,i)=>v(t,e,s,i));return t.addSubscribers(t=>{let o=i._parent;i.length&&(i.forEach(t=>{r(t,"destroy",!0,!0)}),n(o)),t.length&&((i=t.map((t,i)=>v(t,e,s,i))).forEach(t=>{o.appendChild(l(t))}),i._parent=o)}),i}function g(){return u(b)}class b extends h{constructor(){super(...arguments),this.reactive={counter:m(0)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.reactive.counter}}function y(t){return u(C,t)}class C extends h{constructor(t){super(),this.input=t,this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.input.counter}onInit(){console.log("init CountersShared")}onDestroy(){console.log("destroy CountersShared")}}class x extends h{constructor(){super(...arguments),this.reactive={src:m("https://www.w3schools.com/html/pic_trulli.jpg"),disabled:p(!1)},this.fdObjects={imgAttrs:new a({src:this.src}),btnAttrs:new a({disabled:this.disabled})},this.onClick=(()=>{this.src.value="https://www.w3schools.com/html/img_girl.jpg"}),this.changeBtnClick=(()=>{this.disabled.value=!this.disabled.value}),this.btnClick=(()=>{alert("hey")}),this.template={tag:"div",children:[{tag:"div",children:[{tag:"span",textValue:"Current state:"},{tag:"span",textValue:this.disabled},{tag:"button",attrs:this.fdObjects.btnAttrs,textValue:"I am button",listeners:{click:this.btnClick}},{tag:"button",textValue:"Click me to change",listeners:{click:this.changeBtnClick}}]},{tag:"button",textValue:"Click me",listeners:{click:this.onClick}},{tag:"span",textValue:this.src},{tag:"div",children:[{tag:"img",attrs:this.fdObjects.imgAttrs}]}]}}get src(){return this.reactive.src}get disabled(){return this.reactive.disabled}}class k extends h{constructor(){super(...arguments),this.reactive={counter:m(0),classOdd:p(!0)},this.fdObjects={classList:new a({odd:this.currentClass})},this.template={tag:"div",classList:this.fdObjects.classList,textValue:this.counter}}get counter(){return this.reactive.counter}get currentClass(){return this.reactive.classOdd}onInit(){const t=()=>{this.timer=window.setTimeout(()=>{this.counter.value+=1,this.currentClass.value=this.counter.value%2==0,t()},1e3)};t()}onDestroy(){clearTimeout(this.timer)}}function w(){return u(k)}function E(){return u(V)}class V extends h{constructor(){super(...arguments),this.reactive={show:p(!0),text:m("Here timer")},this.onClick=(()=>{this.show.value=!this.show.value,this.text.value=this.show.value?"Here timer":"Sorry not timer"}),this.template={tag:"div",children:[{tag:"p",children:[{tag:"span",textValue:"Current value:"},{tag:"span",textValue:this.show}]},{tag:"button",listeners:{click:this.onClick},textValue:"Change state"},{tag:"div",textValue:"You will see me always"},{tag:"div",show:this.show,textValue:"You will sometimes"},{tag:"div",children:[{tag:"strong",textValue:this.text},Object.assign({},w(),{show:this.show})]}]}}get show(){return this.reactive.show}get text(){return this.reactive.text}}function I(t){return u(j,t)}class j extends h{constructor(t){super(),this.input=t,this.onClick=(()=>{this.todoList.value=this.todoList.value.filter((t,e)=>e!==this.index)}),this.template={tag:"div",children:[{tag:"span",textValue:this.textValue},{tag:"button",textValue:"remove",listeners:{click:this.onClick}}]}}get todoList(){return this.input.todoList}get index(){return this.input.index}get textValue(){return this.input.value}}function O(){return u(L)}class L extends h{constructor(){super(...arguments),this.reactive={inputValue:m(""),todoList:m([])},this.fdObjects={inputValueProp:new a({value:this.inputValue})},this.onInput=(t=>{this.inputValue.value=t.target.value}),this.onClick=(()=>{this.inputValue.value&&(this.todoList.value=[...this.todoList.value,this.inputValue.value],this.inputValue.value="")}),this.inputBlock={tag:"input",attrs:{placeholder:"Write here"},props:this.fdObjects.inputValueProp,listeners:{input:this.onInput}},this.template={tag:"div",children:[{tag:"div",children:[this.inputBlock,{tag:"button",textValue:"add Todo",listeners:{click:this.onClick}}]},{tag:"div",children:[f(this.todoList,I,{todoList:this.todoList,index:(t,e)=>e,value:t=>t})]}]}}get inputValue(){return this.reactive.inputValue}get todoList(){return this.reactive.todoList}}class _ extends h{constructor(){var t;super(...arguments),this.homeBtn=(()=>{d.goToUrl("/")}),this.timerClick=(()=>{d.goToUrl("/timer")}),this.todoClick=(()=>{d.goToUrl("/todo")}),this.ifClick=(()=>{d.goToUrl("/if")}),this.template={tag:"div",children:[{tag:"button",textValue:"Home",listeners:{click:this.homeBtn}},{tag:"button",textValue:"Timer",listeners:{click:this.timerClick}},{tag:"button",textValue:"Todo",listeners:{click:this.todoClick}},{tag:"button",textValue:"If",listeners:{click:this.ifClick}},(t={"/":{component:g,title:"Home app"},"/timer":{component:w,title:"Timer app"},"/todo":{component:O,title:"Todo app"},"/if":{component:E,title:"If conditions"}},d.setPaths(t),d.template)]}}}function A(t={}){return u(T,t)}class T extends h{constructor(t){super(),this.inputs=t,this.template={tag:"div",children:[{tag:"span",textValue:this.counter},y({counter:this.counter})]}}get counter(){return this.inputs.value}onInit(){console.log(`Init ${this.counter.value}`)}onDestroy(){console.log(`Destroy ${this.counter.value}`)}}const S=m([]);setTimeout(()=>{S.value=[1,2,3,4,5],setTimeout(()=>{S.value=[1]},3e3)},3e3);class B extends h{constructor(){super(...arguments),this.reactive={counter:m(-10)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"div",children:[{tag:"button",textValue:"Click me",listeners:{click:this.onClick}},{tag:"textNode",textValue:this.counter}]}}get counter(){return this.reactive.counter}}document.getElementById("todo").appendChild(l(O())),document.getElementById("timer").appendChild(l(w()));const D=document.getElementById("counter");D.appendChild(l(g())),D.appendChild(l(g()));const N=document.getElementById("counter_input"),U=m(0);N.appendChild(l(y({counter:U}))),N.appendChild(l(y({counter:U}))),N.appendChild(l(y({counter:U}))),document.getElementById("simple_if").appendChild(l(E())),document.getElementById("simple_for").appendChild(l({tag:"div",children:[f([1,2,3,4,5,6,7],{tag:"div",textValue:t=>t})]})),document.getElementById("simple_for_component").appendChild(l({tag:"div",children:[f([1,2,3,4,5,6,7],g)]})),document.getElementById("simple_for_obs").appendChild(l({tag:"div",children:[f(S,A,{value:t=>m(t)})]})),document.getElementById("attrs").appendChild(l(u(x))),document.getElementById("text_node").appendChild(l(u(B))),document.getElementById("router").appendChild(l(u(_))),d.onInit()});
//# sourceMappingURL=bundle.js.map
