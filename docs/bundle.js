!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";function t(t,e){Object.keys(e).forEach(s=>{e[s]?t.setAttribute(s,e[s]):t.removeAttribute(s)})}function e(t,e){e&&Object.keys(e).forEach(s=>{Array.isArray(e[s])?e[s].forEach(e=>{t.addEventListener(s,e)}):t.addEventListener(s,e[s])})}function s(t,e,i,...n){if(i)return t.children&&t.children.forEach(t=>{s(t,e,i,...n)}),void(t.instance&&t.instance[e](...n));t.instance&&t.instance[e](...n),t.children&&t.children.forEach(t=>{s(t,e,i,...n)})}class i{constructor(t,e=!1){this._value=t,this.forces=e,this.setterTimeout=null,this.subscribers=[],this.isDestroy=!1,this.firstState=t}get value(){return this._value}destroy(t=!1){this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.isDestroy=!0,t&&delete this.subscribers}reInit(){this.isDestroy=!1,this.value=this.firstState}addSubscribers(t){this.isDestroy||this.subscribers.push(t)}set value(t){this.isDestroy||(this._value!==t||this.forces)&&(this._value=t,this.subscribers.length&&(this.setterTimeout&&cancelAnimationFrame(this.setterTimeout),this.setterTimeout=requestAnimationFrame(()=>{this.subscribers.forEach(e=>{e(t)})})))}}class n{constructor(t={}){this.obsArr=[],this.values={},this.obs=new i(this.values,!0),Object.keys(t).forEach(e=>{const s=t[e];"object"==typeof s?(this.obsArr.push(s),this.values[e]=s.value,s.addSubscribers(t=>{this.values[e]=t,this.obs.value=this.values})):this.values[e]=s})}get value(){return this.obs}reInit(){this.obs.reInit(),this.obsArr.forEach(t=>{t.reInit()})}destroy(){this.obs.destroy(),this.obsArr.forEach(t=>{t.destroy()})}}const r=Symbol("instance");function a(i){if(!0===i.skip)return null;const o="textNode"!==i.tag?document.createElement(i.tag):document.createTextNode("");if(i.textValue)if("object"==typeof i.textValue){const t=i.textValue;t.addSubscribers(t=>{o.textContent=t}),o.textContent=t.value}else o.textContent=i.textValue;let c,u;if("textNode"!==i.tag){if(i.classList)if(Array.isArray(i.classList))i.classList.forEach(t=>{o.classList.add(t)});else{c=i.classList;const t=i.classList.value;Object.keys(t.value).forEach(e=>{return t.value[e]?o.classList.add(e):o.classList.remove(e)}),t.addSubscribers(t=>{Object.keys(t).forEach(e=>{return t[e]?o.classList.add(e):o.classList.remove(e)})})}if(i.attrs)if(i.attrs instanceof n){u=i.attrs;const e=i.attrs.value;t(o,e.value),e.addSubscribers(e=>{t(o,e)})}else t(o,i.attrs);i.children&&i.children.forEach(t=>{if(!t)return;if(Array.isArray(t))return t.forEach(t=>{if(!t.tag)return void o.appendChild(t);const e=a(Object.assign({},t,{parent:o}));e&&o.appendChild(e)}),void(t._parent=o);if(!t.tag)return void o.appendChild(t);const e=a(Object.assign({},t,{parent:o}));e&&o.appendChild(e)}),i.listeners&&e(o,i.listeners)}if(i.instance&&(o[r]=i.instance,i.instance.onInit()),"object"==typeof i.skip){const t=document.createComment("");return i.skip.addSubscribers(n=>{const r=i.parent?i.parent:null;n?r&&(r.replaceChild(o,t),s(i,"reInit",!1),c&&c.reInit(),u&&u.reInit(),"textNode"!==i.tag&&e(o,i.listeners)):r&&("textNode"!==i.tag&&function(t,e){e&&Object.keys(e).forEach(s=>{Array.isArray(e[s])?e[s].forEach(e=>{t.removeEventListener(s,e)}):t.removeEventListener(s,e[s])})}(o,i.listeners),u&&u.destroy(),c&&c.destroy(),s(i,"destroy",!0),r.replaceChild(t,o))}),i.skip.value?o:t}return o}function o(t,e){const s=new t(e);return s.template.instance=s,s.template}class c{constructor(){this.reactive={}}onDestroy(){}onInit(){}reInit(){Object.keys(this.reactive).forEach(t=>{this.reactive[t].reInit()}),this.onInit()}destroy(...t){Object.keys(this.reactive).forEach(e=>{this.reactive[e].destroy(...t)}),this.onDestroy()}}function u(t){return new i(t)}function l(t){return new i(t)}const h=(t,e,s={},i)=>{if("function"==typeof e){const n={};return Object.keys(s).forEach(e=>{const i=s[e];n[e]="function"==typeof i?i(t):i}),e(Object.assign({},n,{index:i}))}return Object.assign({},e,{textValue:e.textValue(t),index:i})};function d(t,e,i={}){if(Array.isArray(t))return t.map((t,s)=>h(t,e,i,s));let n=t.value.map((t,s)=>h(t,e,i,s));return t.addSubscribers(t=>{let r=n._parent;n.length&&(n.forEach(t=>{s(t,"destroy",!0,!0)}),function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(r)),t.length&&((n=t.map((t,s)=>h(t,e,i,s))).forEach(t=>{r.appendChild(a(t))}),n._parent=r)}),n}function p(){return o(v)}class v extends c{constructor(){super(...arguments),this.reactive={counter:l(0)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.reactive.counter}}function g(t){return o(m,t)}class m extends c{constructor(t){super(),this.input=t,this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"button",textValue:this.counter,listeners:{click:this.onClick}}}get counter(){return this.input.counter}onInit(){console.log("init CountersShared")}onDestroy(){console.log("destroy CountersShared")}}class f extends c{constructor(){super(...arguments),this.reactive={src:l("https://www.w3schools.com/html/pic_trulli.jpg"),disabled:u(!1)},this.onClick=(()=>{this.src.value="https://www.w3schools.com/html/img_girl.jpg"}),this.changeBtnClick=(()=>{this.disabled.value=!this.disabled.value}),this.btnClick=(()=>{alert("hey")}),this.template={tag:"div",children:[{tag:"div",children:[{tag:"span",textValue:"Current state:"},{tag:"span",textValue:this.disabled},{tag:"button",attrs:new n({disabled:this.disabled}),textValue:"I am button",listeners:{click:this.btnClick}},{tag:"button",textValue:"Click me to change",listeners:{click:this.changeBtnClick}}]},{tag:"button",textValue:"Click me",listeners:{click:this.onClick}},{tag:"span",textValue:this.src},{tag:"div",children:[{tag:"img",attrs:new n({src:this.src})}]}]}}get src(){return this.reactive.src}get disabled(){return this.reactive.disabled}}class b extends c{constructor(){super(...arguments),this.reactive={counter:l(0),classOdd:u(!0)},this.template={tag:"div",classList:new n({odd:this.currentClass}),textValue:this.counter}}get counter(){return this.reactive.counter}get currentClass(){return this.reactive.classOdd}onInit(){const t=()=>{this.timer=window.setTimeout(()=>{this.counter.value+=1,this.currentClass.value=this.counter.value%2==0,t()},1e3)};t()}onDestroy(){clearTimeout(this.timer)}}function y(){return o(b)}class x extends c{constructor(){super(...arguments),this.reactive={show:u(!0),text:l("Here timer")},this.onClick=(()=>{this.show.value=!this.show.value,this.text.value=this.show.value?"Here timer":"Sorry not timer"}),this.template={tag:"div",children:[{tag:"p",children:[{tag:"span",textValue:"Current value:"},{tag:"span",textValue:this.show}]},{tag:"button",listeners:{click:this.onClick},textValue:"Change state"},{tag:"div",textValue:"You will see me always"},{tag:"div",skip:this.show,textValue:"You will sometimes"},{tag:"div",children:[{tag:"strong",textValue:this.text},Object.assign({},y(),{skip:this.show})]}]}}get show(){return this.reactive.show}get text(){return this.reactive.text}}function C(t={}){return o(k,t)}class k extends c{constructor(t){super(),this.inputs=t,this.template={tag:"div",children:[{tag:"span",textValue:this.counter},g({counter:this.counter})]}}get counter(){return this.inputs.value}onInit(){console.log(`Init ${this.counter.value}`)}onDestroy(){console.log(`Destroy ${this.counter.value}`)}}const V=l([]);setTimeout(()=>{V.value=[1,2,3,4,5],setTimeout(()=>{V.value=[1]},3e3)},3e3);class E extends c{constructor(){super(...arguments),this.reactive={counter:l(-10)},this.onClick=(()=>{this.counter.value+=1}),this.template={tag:"div",children:[{tag:"button",textValue:"Click me",listeners:{click:this.onClick}},{tag:"textNode",textValue:this.counter}]}}get counter(){return this.reactive.counter}}function w(t){return o(I,t)}class I extends c{constructor(t){super(),this.input=t,this.onClick=(()=>{this.todoList.value=this.todoList.value.filter((t,e)=>e!==this.index)}),this.template={tag:"div",children:[{tag:"span",textValue:this.textValue},{tag:"button",textValue:"remove",listeners:{click:this.onClick}}]}}get todoList(){return this.input.todoList}get index(){return this.input.index}get textValue(){return this.input.value}}class L extends c{constructor(){super(),this.reactive={inputValue:l(""),todoList:l([])},this.onInput=(t=>{this.inputValue.value=t.target.value}),this.onClick=(()=>{this.inputValue.value&&(this.todoList.value=[...this.todoList.value,this.inputValue.value],this.inputValue.value="")}),this.inputBlock=a({tag:"input",attrs:{placeholder:"Write here"},listeners:{input:this.onInput}}),this.template={tag:"div",children:[{tag:"div",children:[this.inputBlock,{tag:"button",textValue:"add Todo",listeners:{click:this.onClick}}]},{tag:"div",children:[d(this.todoList,w,{todoList:this.todoList,index:(t,e)=>e,value:t=>t})]}]},this.inputValue.addSubscribers(t=>{this.inputBlock.value=t})}get inputValue(){return this.reactive.inputValue}get todoList(){return this.reactive.todoList}}document.getElementById("todo").appendChild(a(o(L))),document.getElementById("timer").appendChild(a(y()));const j=document.getElementById("counter");j.appendChild(a(p())),j.appendChild(a(p()));const A=document.getElementById("counter_input"),_=l(0);A.appendChild(a(g({counter:_}))),A.appendChild(a(g({counter:_}))),A.appendChild(a(g({counter:_}))),document.getElementById("simple_if").appendChild(a(o(x))),document.getElementById("simple_for").appendChild(a({tag:"div",children:[d([1,2,3,4,5,6,7],{tag:"div",textValue:t=>t})]})),document.getElementById("simple_for_component").appendChild(a({tag:"div",children:[d([1,2,3,4,5,6,7],p)]})),document.getElementById("simple_for_obs").appendChild(a({tag:"div",children:[d(V,C,{value:t=>l(t)})]})),document.getElementById("attrs").appendChild(a(o(f))),document.getElementById("text_node").appendChild(a(o(E)))});
//# sourceMappingURL=bundle.js.map
